Автор данный страницы: Шуруб Игорь (https://github.com/igorshurub)
# SQL Injection (SQL инъекция)
## Теория
### Определение
SQL-инъекция (SQL Injection) — это один из самых распространённых и опасных видов атак на веб-приложения, при котором злоумышленник может встраивать вредоносный SQL-код в запросы к базе данных. Цель таких атак — получить несанкционированный доступ к данным, изменить их или даже полностью удалить.
### Как это работает?
SQL-запросы используются для взаимодействия с базами данных. Например, когда пользователь вводит своё имя и пароль на сайте, система отправляет запрос к базе данных, чтобы проверить, существуют ли такие данные. Пример простого SQL-запроса:
* `SELECT * FROM users WHERE username = 'имя' AND password = 'пароль';`

Если в поле ввода злоумышленник введёт не просто имя, а что-то вроде:
* `имя' OR '1'='1`

SQL-запрос изменится следующим образом:

* `SELECT * FROM users WHERE username = 'имя' OR '1'='1' AND password = 'пароль';`

Что здесь произошло? Вторая часть запроса OR '1'='1' всегда возвращает истину. Это значит, что запрос пропустит проверку и даст доступ даже без правильного имени пользователя или пароля.

### Виды SQL-инъекций:
* Простая инъекция: когда злоумышленник напрямую добавляет свой код в поле ввода. Это может привести к раскрытию данных или выполнению произвольных команд.

* Слепая инъекция: когда сайт не возвращает ошибку или данные напрямую, но злоумышленник может делать выводы на основе поведения приложения (например, задержки в ответах).

* Инъекция в условие: злоумышленник может добавлять в запрос логические операторы (как в примере выше), чтобы заставить систему принять его данные.

### Как защититься от SQL-инъекций?

1. **Используйте подготовленные запросы (prepared statements)**: они разделяют данные и сам SQL-код, что не даёт злоумышленникам встроить свой код. 

2. **Используйте ORM (Object-Relational Mapping)**: это библиотеки, которые автоматизируют взаимодействие с базами данных и снижают риск SQL-инъекций.

3. **Валидация ввода:** проверяйте и фильтруйте данные, которые вводят пользователи. Например, убедитесь, что вместо букв они не вставляют SQL-код.

4. **Ограничьте права доступа к базе данных:** приложение должно иметь только минимальные необходимые права для выполнения своих функций.


## Практика:

Теперь давайте закрепим теорию на практике и попробуем выполнить несколько упражнений по эксплуатированию SQL-инъекций, для этого воспользуемся следующим бесплатным сервисом: (https://sql.training.hackerdom.ru/) Попробуйте выполнить их самостоятельно ниже будет разбор данных заданий.

### Задание 1.
![image](https://github.com/AnaktaCTF/CTFReports/blob/main/Shurub%20Igor%20201-331/XSS/1.png)

Пояснение: выполняем запрос к БД users, выводя данные для строки 12, обращаем внимание, что ссылка выглядит следующим образом: https://sql.training.hackerdom.ru/1.php?text=SELECT+*+FROM+users+WHERE+id%3D12

### Задание 2.
![image](https://github.com/AnaktaCTF/CTFReports/blob/main/Shurub%20Igor%20201-331/XSS/2.png)

Пояснение: 
Нам дана подсказка использовать кавычку, этим и воспользуемся. 

То есть мы пытаемся получить данные из таблицы users для пользователя с id=2 или с login=1, а также для пользователя с id=9, при этом id=9 отделено кавычкой с одной стороны и закрывается кавычкой оригинального SQL-запроса. Поскольку пользователя с id=-1 не существует, никаких данных по нему мы не получаем, но id=9 существует в базе. В итоге запрос возвращает две строки — одну для пользователя с id=2 и другую для пользователя с id=9. Данная уязвимость реализуема потому что вводимые (входные) данные никак не фильтруются. https://sql.training.hackerdom.ru/2qnbutn.php?text=text%3D-1%27+or++id%3D%279 


### Задание 3.
![image](https://github.com/AnaktaCTF/CTFReports/blob/main/Shurub%20Igor%20201-331/XSS/3.png)

Пояснение: 
Видим, что по сравнению с предыдущим заданием присутствует условие limit 1 - ограничение на вывод в 1 строку. Выйти из этой ситуации можно следующим образом, добавляем комментарий, например --hello, limit 1 уберет его (комментарий), но при этом выведет нужную нам строку с id=13. https://sql.training.hackerdom.ru/3sdjjy.php?text=text%3D%27-1+or++id%3D%2713+%27--+123

### Задание 4.
![image](https://github.com/AnaktaCTF/CTFReports/blob/main/Shurub%20Igor%20201-331/XSS/4.png)

Пояснение: 
Нам дано две таблицы и запрос по умолчанию будет выполнен не к той таблице, которая нам нужна. Чтобы выйти из данной ситуации воспользуемся оператором UNION, позволяющий выполнять запросы к разным таблицам в рамках одного запроса. Для использования объединения запросов важно, чтобы количество полей во всех объединённых запросах совпадало. Также учитываем, что по условию нам нужно получить данные из таблицы sercet, где значение поля ggg равно abc. https://sql.training.hackerdom.ru/4qjqhweh.php?text=-1%27+union+select+*+from+secret+where+ggg%3D%27abc%27+--+123

## Вывод:

Таким образом, SQL-инъекция — это серьёзная угроза безопасности. Такая уязвимость может привести к компрометации всей базы данных, поэтому важно тщательно проверять и защищать приложения от подобных атак.
