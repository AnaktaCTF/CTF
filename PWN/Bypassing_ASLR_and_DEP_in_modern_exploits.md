# Обход ASLR и DEP в современных эксплойтах
С развитием технологий безопасности, такие механизмы, как **ASLR** (Address Space Layout Randomization) и **DEP** (Data Execution Prevention), значительно усложнили задачу для атакующих. Эти технологии защищают память от ряда популярных атак, таких как переполнение буфера, но всё же не делают систему неприступной. Злоумышленники по-прежнему разрабатывают новые методы обхода этих защит, что продолжает быть важной темой в области информационной безопасности.

В этой статье рассмотрим, как именно обходятся **ASLR** и **DEP**, и какие методы используют хакеры для эксплуатации уязвимостей.
________________________________________
![image](https://github.com/user-attachments/assets/1f7f4c44-7faa-40c8-ab8b-1bf6f8d5cd51)

### Что такое ASLR?

ASLR (случайная организация адресного пространства) — это технология защиты, которая случайным образом меняет расположение важных структур в памяти, таких как стек, куча и динамически загружаемые библиотеки (например, libc в Linux или kernel32.dll в Windows). Это делает сложным предсказание точных адресов в памяти, что сильно затрудняет успешные атаки, основанные на знании этих адресов.

### Как обходят ASLR?

*Утечка адресов*

Одна из самых распространённых техник обхода ASLR — это использование утечек памяти. Когда программа случайно выводит важные данные, такие как адреса или указатели, в логах или через другие каналы, атакующий может использовать эти данные для дальнейших действий.
Пример: Если программа выводит в журнал важные внутренние указатели, злоумышленник может получить доступ к этим данным и использовать их для того, чтобы точно определить расположение важных объектов в памяти. Это позволяет обойти случайную организацию памяти.

*Return-Oriented Programming (ROP)*

Если с ASLR всё-таки можно столкнуться, то злоумышленники могут использовать ROP. Вместо того, чтобы напрямую выполнить вредоносный код, атакующий запускает цепочку инструкций (гаджетов), которые уже присутствуют в памяти программы. Это позволяет манипулировать выполнением программы, не полагаясь на точные адреса.
Например, используя переполнение буфера, атакующий может подставить в стек адреса, указывающие на существующие в памяти инструкции (гаджеты), которые выполнят нужные действия.
________________________________________
### Что такое DEP?

DEP (предотвращение выполнения данных) — это защита, которая предотвращает выполнение кода в некоторых областях памяти. Например, если программа пытается выполнить вредоносный код, размещённый на стеке или в куче, выполнение этого кода будет заблокировано. DEP защищает от атак, в которых вредоносный код внедряется в эти области памяти, например, при переполнении буфера.

### Как обходят DEP?

*Return-Oriented Programming (ROP)*

Как и с ASLR, ROP помогает обойти DEP. Так как в памяти уже есть исполнимые инструкции, атака не требует выполнения кода в защищённых областях. Используя цепочку таких инструкций, атакующий может обойти защиту.

*JIT-компиляция*

В некоторых приложениях, особенно в браузерах, используется JIT-компиляция (Just-In-Time). Когда код генерируется на лету, он может быть размещён в памяти в таких областях, где DEP не действует. Это позволяет атакующим использовать уязвимости в таких компиляторах для выполнения произвольного кода.

*Системные вызовы (System Calls)*

Атакующие могут также использовать системные вызовы, чтобы обойти DEP. Например, они могут вызвать функцию операционной системы, которая загрузит или выполнит код из области памяти, не защищённой DEP.
________________________________________
### Комбинированные методы обхода ASLR и DEP
Современные эксплойты часто используют несколько техник сразу, чтобы обойти обе защиты. 
Например:
#### Утечка адресов помогает обойти ASLR, предоставляя точную информацию о том, где находятся важные объекты в памяти.

#### ROP используется для обхода как ASLR, так и DEP. Вместо того, чтобы выполнять вредоносный код, атакующий использует уже существующие инструкции, чтобы выполнить свою цель.

Такая комбинация методов позволяет преодолевать защиты, даже если система использует ASLR и DEP.
________________________________________
### Современные механизмы защиты
Задача по защите от атак становится всё сложнее, и в ответ на методы обхода ASLR и DEP были разработаны новые защитные технологии.

*Control Flow Integrity (CFI)*

CFI помогает предотвратить изменение потока выполнения программы. Даже если атакующий использует ROP, он не сможет выполнить несанкционированные инструкции, так как CFI строго ограничивает, где могут происходить переходы.

*Stack Canaries*

Это специальные "сторожевые" значения, которые вставляются между данными на стеке и адресами возврата. Если злоумышленник пытается перезаписать адрес возврата (например, при переполнении буфера), это значение будет повреждено, и программа распознает попытку атаки.

*Реализация DEP*

В некоторых системах защита от выполнения кода не ограничивается только куском памяти, но распространяется на весь процесс. Такой подход даёт дополнительные гарантии безопасности и усложняет использование техник вроде ROP.
________________________________________

Невзирая на постоянное улучшение механизмов безопасности, таких как ASLR и DEP, хакеры находят новые способы обойти эти защиты. Комбинированные методы, такие как использование утечек адресов и ROP, остаются важными инструментами в арсенале атакующих. Однако новые технологии защиты, такие как CFI и stack canaries, значительно усложняют процесс эксплуатации уязвимостей.
Этот постоянный процесс "обострения" между защитой и атакой требует от разработчиков и специалистов по безопасности постоянной работы над улучшением защиты и созданием новых методов для борьбы с современными угрозами.

