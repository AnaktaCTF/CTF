# Privilege Escalation в CTF: от рядового пользователя до администратора

Privilege Escalation, или повышение привилегий, представляет собой одну из наиболее распространенных и увлекательных техник, используемых в соревнованиях формата Capture The Flag (CTF). Этот метод позволяет участникам продемонстрировать глубокое понимание принципов информационной безопасности и умение находить уязвимости в системах для получения доступа к защищенным ресурсам. Повышение привилегий часто является ключевым этапом в решении комплексных CTF-задач, позволяя преодолеть ограничения прав доступа и захватить финальный флаг. В данной статье мы рассмотрим сущность этой техники, её методы применения и приведем конкретный пример, демонстрирующий эффективность Privilege Escalation в контексте CTF-соревнований.

## Что такое Privilege Escalation

Privilege Escalation (повышение привилегий) — это использование различных уязвимостей операционной системы и прикладного программного обеспечения для повышения своих полномочий в атакуемой системе. В контексте Linux-систем под повышением привилегий обычно подразумевается получение прав суперпользователя (root) при работе от обычного пользователя. Эта техника является важным элементом многих CTF-заданий, особенно в категориях PWN и admin.

## Методы Privilege Escalation

Повышение привилегий может осуществляться различными способами в зависимости от типа операционной системы, конфигурации и установленного программного обеспечения. Основные методы включают:

### Использование физического доступа

В некоторых CTF-заданиях предоставляется прямой доступ к виртуальной машине, что может позволить использовать специфические уязвимости, связанные с загрузкой системы или доступом к физическим носителям информации. Однако этот метод ограничен в онлайн-соревнованиях.

### Использование ошибок администрирования

Неправильная настройка разрешений на файлы и директории, небезопасные конфигурации сервисов, слабые пароли — все это может быть использовано для повышения привилегий. В CTF-заданиях часто намеренно оставляют такие уязвимости, и участникам необходимо их выявить и эксплуатировать.

### Эксплуатация логических и бинарных уязвимостей

Этот метод включает эксплуатацию уязвимостей в привилегированных сервисах, выполняющихся в системе. Особую ценность представляют уязвимости типа buffer overflow, use-after-free, race condition и другие, которые могут привести к выполнению произвольного кода с повышенными привилегиями.

### Атаки на ядро операционной системы

В некоторых более сложных CTF-заданиях может потребоваться эксплуатация уязвимостей в ядре операционной системы для получения максимальных привилегий.

## Применение Privilege Escalation в CTF

### Когда использовать повышение привилегий

Privilege Escalation используется в CTF-соревнованиях в следующих случаях:

1. Когда начальный доступ к системе осуществляется с ограниченными правами, а флаг находится в защищенном месте, доступном только пользователям с более высокими привилегиями.
2. При необходимости выполнить действия, требующие административных прав (установка программного обеспечения, изменение системных настроек, доступ к защищенным файлам).
3. Для продвижения по цепочке эскалации в многоэтапных заданиях, где требуется последовательное повышение привилегий (например, от student → teacher → admin → root).

### Как применять повышение привилегий

Процесс применения Privilege Escalation в CTF-заданиях обычно включает следующие этапы:

1. Разведка системы: сбор информации о версии операционной системы, установленных сервисах, пользователях и группах, файловой системе.
2. Выявление потенциальных уязвимостей: поиск SUID-бинарных файлов, служб, запущенных с повышенными привилегиями, небезопасных разрешений, уязвимых версий программного обеспечения.
3. Эксплуатация уязвимостей: использование выявленных уязвимостей для получения более высоких привилегий.
4. Получение доступа к флагу: использование повышенных привилегий для доступа к защищенным ресурсам и получения флага.

## Пример применения Privilege Escalation в CTF

Рассмотрим пример задания из CTF-соревнования, где требуется последовательное повышение привилегий для получения флагов. Задание предполагает наличие четырех учетных записей: student, teacher, admin и root, причем флаги находятся в файлах FLAG1, FLAG2, FLAG3 и FLAG4.

### Шаг 1: Первичная разведка

При входе в систему мы обнаруживаем, что вошли под учетной записью student. Первым делом проверяем наличие флагов в системе:

```bash
student@attackdefense:~$ find / -name FLAG* 2>/dev/null
/home/admin/FLAG2
```

Мы обнаружили флаг FLAG2 в домашнем каталоге пользователя admin, но пока не имеем к нему доступа. Необходимо найти способ повысить привилегии.

### Шаг 2: Выявление возможностей повышения привилегий

Проверим наличие SUID-бинарных файлов, которые могут быть использованы для повышения привилегий:

```bash
student@attackdefense:~$ find / -perm -u=s -type f 2>/dev/null
```

Предположим, что мы нашли нестандартный SUID-бинарный файл, принадлежащий пользователю teacher. Анализируя его, мы обнаруживаем, что он уязвим к buffer overflow.

### Шаг 3: Эксплуатация уязвимости и повышение до teacher

Используя обнаруженную уязвимость, мы эксплуатируем SUID-бинарный файл и получаем оболочку с привилегиями пользователя teacher. Теперь мы можем искать FLAG1 и способы дальнейшего повышения привилегий.

### Шаг 4: Повышение до admin

В домашнем каталоге teacher мы обнаруживаем скрипт, который запускается с привилегиями admin через cron-задачу (запланированную задачу). Модифицируя этот скрипт, мы можем добавить команду, создающую оболочку с привилегиями admin или изменяющую разрешения на FLAG2.

### Шаг 5: Получение root и всех флагов

В системе sudo настроен таким образом, что пользователь admin может запускать определенные команды с привилегиями root без пароля. Используя эту возможность, мы повышаем привилегии до root и получаем доступ ко всем оставшимся флагам.

## Рекомендации по подготовке к заданиям на Privilege Escalation

Для успешного решения CTF-заданий на Privilege Escalation рекомендуется:

1. Изучить типичные методы повышения привилегий для различных операционных систем (Linux, Windows, macOS).
2. Практиковаться на специальных виртуальных машинах, созданных для тренировки навыков повышения привилегий.
3. Освоить инструменты автоматизации поиска уязвимостей (LinPEAS, LinEnum, WinPEAS и другие).
4. Понимать принципы работы разрешений в файловых системах и механизмов контроля доступа в операционных системах.
5. Следить за новыми уязвимостями и методами повышения привилегий, поскольку CTF-задания часто основываются на реальных сценариях атак.

## Заключение

Privilege Escalation является важным и часто встречающимся компонентом CTF-заданий, требующим от участников глубокого понимания принципов информационной безопасности и умения находить и эксплуатировать уязвимости в системах. Владение техниками повышения привилегий не только помогает успешно решать задания на CTF-соревнованиях, но и формирует ценные навыки для работы в области информационной безопасности. Использование различных методов Privilege Escalation, от эксплуатации ошибок конфигурации до применения сложных технических уязвимостей, делает этот аспект CTF-соревнований особенно интересным и познавательным для участников всех уровней подготовки.
