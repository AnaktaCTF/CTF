# Privilege Escalation в CTF: от рядового пользователя до администратора

Privilege Escalation, или повышение привилегий, представляет собой одну из наиболее распространенных и увлекательных техник, используемых в соревнованиях формата Capture The Flag (CTF). Этот метод позволяет участникам продемонстрировать глубокое понимание принципов информационной безопасности и умение находить уязвимости в системах для получения доступа к защищенным ресурсам. Повышение привилегий часто является ключевым этапом в решении комплексных CTF-задач, позволяя преодолеть ограничения прав доступа и захватить финальный флаг. В данной статье мы рассмотрим сущность этой техники, её методы применения и приведем конкретный пример, демонстрирующий эффективность Privilege Escalation в контексте CTF-соревнований.

## Что такое Privilege Escalation

Privilege Escalation (повышение привилегий) — это использование различных уязвимостей операционной системы и прикладного программного обеспечения для повышения своих полномочий в атакуемой системе. В контексте Linux-систем под повышением привилегий обычно подразумевается получение прав суперпользователя (root) при работе от обычного пользователя. Эта техника является важным элементом многих CTF-заданий, особенно в категориях PWN и admin.

## Методы Privilege Escalation

Повышение привилегий может осуществляться различными способами в зависимости от типа операционной системы, конфигурации и установленного программного обеспечения. Основные методы включают:

### Использование физического доступа

В некоторых CTF-заданиях предоставляется прямой доступ к виртуальной машине, что может позволить использовать специфические уязвимости, связанные с загрузкой системы или доступом к физическим носителям информации. Однако этот метод ограничен в онлайн-соревнованиях.

### Использование ошибок администрирования

Неправильная настройка разрешений на файлы и директории, небезопасные конфигурации сервисов, слабые пароли — все это может быть использовано для повышения привилегий. В CTF-заданиях часто намеренно оставляют такие уязвимости, и участникам необходимо их выявить и эксплуатировать.

### Эксплуатация логических и бинарных уязвимостей

Этот метод включает эксплуатацию уязвимостей в привилегированных сервисах, выполняющихся в системе. Особую ценность представляют уязвимости типа buffer overflow, use-after-free, race condition и другие, которые могут привести к выполнению произвольного кода с повышенными привилегиями.

### Атаки на ядро операционной системы

В некоторых более сложных CTF-заданиях может потребоваться эксплуатация уязвимостей в ядре операционной системы для получения максимальных привилегий.

## Применение Privilege Escalation в CTF

### Когда использовать повышение привилегий

Privilege Escalation используется в CTF-соревнованиях в следующих случаях:

1. Когда начальный доступ к системе осуществляется с ограниченными правами, а флаг находится в защищенном месте, доступном только пользователям с более высокими привилегиями.
2. При необходимости выполнить действия, требующие административных прав (установка программного обеспечения, изменение системных настроек, доступ к защищенным файлам).
3. Для продвижения по цепочке эскалации в многоэтапных заданиях, где требуется последовательное повышение привилегий (например, от student → teacher → admin → root).

### Как применять повышение привилегий

Процесс применения Privilege Escalation в CTF-заданиях обычно включает следующие этапы:

1. Разведка системы: сбор информации о версии операционной системы, установленных сервисах, пользователях и группах, файловой системе.
2. Выявление потенциальных уязвимостей: поиск SUID-бинарных файлов, служб, запущенных с повышенными привилегиями, небезопасных разрешений, уязвимых версий программного обеспечения.
3. Эксплуатация уязвимостей: использование выявленных уязвимостей для получения более высоких привилегий.
4. Получение доступа к флагу: использование повышенных привилегий для доступа к защищенным ресурсам и получения флага.

## Пример применения Privilege Escalation в CTF

Рассмотрим задание ["RootMe"](https://tryhackme.com/room/rrootme) с сайта "TryHackMe".

Для начала проведём сканирование портов машины:
![priv_esc_0](https://github.com/user-attachments/assets/3fac7b14-b3ec-49ec-8a46-7bdb85202789)

Видим открытый 80 порт с http сервисом. На самом сайте нет ничего интересного, поэтому с помощью инструмента GoBuster попробуем перебрать директории.
![priv_esc_1](https://github.com/user-attachments/assets/049e6ecc-cb11-480e-957c-1d758fa6f446)

Из необычного, видим директории "/panel" и "/uploads", переходим на "/panel" и видим предложение загрузки файла. Загрузим файл с [php-reverce-shell](https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php) (примечание: файл с расширением .php загрузить не даёт, поэтому меняем расширение на .php5 или .phttp)
![priv_esc_2](https://github.com/user-attachments/assets/d8049a89-95aa-484a-a200-395904dea575)
![priv_esc_3](https://github.com/user-attachments/assets/f859ef4c-9449-443d-92ea-222bc238c0a2)

После успешной загрузки нашего файла, мы можем увидеть его в директории "/uploads":
![priv_esc_4](https://github.com/user-attachments/assets/93f7c113-eda2-4eec-8bb4-d576d205b376)

Ставим Listener на порт, указанный в скрипте. Если всё прошло успешно, то мы получаем доступ к shell.
![priv_esc_5](https://github.com/user-attachments/assets/ac1bffe6-0390-4327-93ad-dcf78c43eed9)

Попытаемся повысить свои привилегии. С помощью команды "find / -perm -u=s 2>/dev/null" ищем файлы с SUID разрешениями.
![priv_esc_6](https://github.com/user-attachments/assets/480da26d-2248-4245-a843-5ce43a974a7b)

По какой то причине, файл /usr/bin/python имеет эти разрешения, нам же лучше. С помощью команды "./python -c 'import os; os.execl("/bin/sh", "sh", "-p")'", взятой с [GTFOBins](https://gtfobins.github.io/gtfobins/python/#suid), становимся root пользователем. Флаг для root можно найти по директории "/root". Задание выполнено.
![priv_esc_7](https://github.com/user-attachments/assets/c469a5d2-dd11-48a2-b78f-abb545d17c37)


## Рекомендации по подготовке к заданиям на Privilege Escalation

Для успешного решения CTF-заданий на Privilege Escalation рекомендуется:

1. Изучить типичные методы повышения привилегий для различных операционных систем (Linux, Windows, macOS).
2. Практиковаться на специальных виртуальных машинах, созданных для тренировки навыков повышения привилегий.
3. Освоить инструменты автоматизации поиска уязвимостей (LinPEAS, LinEnum, WinPEAS и другие).
4. Понимать принципы работы разрешений в файловых системах и механизмов контроля доступа в операционных системах.
5. Следить за новыми уязвимостями и методами повышения привилегий, поскольку CTF-задания часто основываются на реальных сценариях атак.

## Заключение

Privilege Escalation является важным и часто встречающимся компонентом CTF-заданий, требующим от участников глубокого понимания принципов информационной безопасности и умения находить и эксплуатировать уязвимости в системах. Владение техниками повышения привилегий не только помогает успешно решать задания на CTF-соревнованиях, но и формирует ценные навыки для работы в области информационной безопасности. Использование различных методов Privilege Escalation, от эксплуатации ошибок конфигурации до применения сложных технических уязвимостей, делает этот аспект CTF-соревнований особенно интересным и познавательным для участников всех уровней подготовки.
